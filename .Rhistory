summarize(total_app = sum(ordinance_amount)) %>%
mutate(perc_total = round((total_app/sum(total_app))*100, 2)) %>%
arrange(desc(total_app)) %>%
kable(align = "lccrr",
format.args = list(big.mark = ","),
caption = "Chicago Budget Appropriations by Fund",
col.names = c("Fund Description", "Total Appropriation ($)", "% of Total"),
"simple",
table.placement = "H")
corp_top_ten <- FY21 %>%
filter(fund_description == "CORPORATE FUND") %>%
group_by(department_description) %>%
summarize(total_app = sum(ordinance_amount)) %>%
arrange(desc(total_app)) %>%
head(10) %>%
rename("top_ten" = department_description)
FY21 %>%
filter(fund_description == "CORPORATE FUND") %>%
mutate(department_description = if_else(
!department_description %in% corp_top_ten$top_ten,
"MISCELLANEOUS",
department_description
)
) %>%
group_by(department_description) %>%
summarize(total_app = sum(ordinance_amount)) %>%
mutate(total_app = round(total_app / 1000000),
money = paste0("$", total_app)) %>%
treemap(
index = c("department_description", "money"),
vSize = "total_app",
type = "index",
title = "Chicago Corporate Fund Allocations, Millions of $",
palette = "YlGnBu",
fontsize.labels = c(10, 10),
fontcolor.labels = c("black", "black"),
bg.labels=c("transparent"),
align.labels = list(c("left", "top"),
c("right", "bottom")),
inflate.labels = F)
FY21 %>%
filter(fund_description == "CORPORATE FUND") %>%
mutate(department_description = if_else(
!department_description %in% corp_top_ten$top_ten,
"MISCELLANEOUS",
department_description
)
) %>%
group_by(department_description) %>%
summarize(total_app = sum(ordinance_amount)) %>%
mutate(perc_total = round((total_app/sum(total_app))*100, 2)) %>%
arrange(desc(total_app)) %>%
kable(align = "lccrr",
format.args = list(big.mark = ","),
caption = "Corporate Fund by Department",
col.names = c("Dept Description", "Total Appropriation ($)", "% of Total"),
"simple",
table.placement = "H")
ts_top_ten_pos <- ts_FY21 %>%
# exclude hourly workers, throws off totals
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(total_app = sum(total_budgeted_unit)) %>%
rename("top_ten" = department_description) %>%
arrange(desc(total_app)) %>%
head(10)
ts_FY21 %>%
filter(position_control == "1") %>%
mutate(department_description = if_else(
!department_description %in% ts_top_ten_pos$top_ten,
"MISCELLANEOUS",
department_description
)
) %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit),
sal_app = sum(total_budgeted_amount)) %>%
mutate(perc_total = round((emply_num/sum(emply_num))*100, 2),
perc_total_sal = round((sal_app/sum(sal_app))*100, 2)) %>%
select(department_description,
emply_num,
perc_total,
sal_app,
perc_total_sal) %>%
arrange(desc(emply_num)) %>%
kable(align = "lccrr",
format.args = list(big.mark = ","),
caption = "Positions by Department",
col.names = c("Department",
"Total Positions",
"% of Positions",
"Salary App. ($)",
"% Salary App."),
"simple",
table.placement = "H")
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_brewer(palette = "YlGnBu") +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous(palette = "YlGnBu") +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_economist() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_colour_gradient2_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
scale_fill_continuous_tableau
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous(palette = "YlGnBu") +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous(colors = "YlGnBu") +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
library(RColorBrewer)
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous(palette = "YlGnBu") +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department") +
scale_fill_continuous_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department",
caption = "source: data.cityofchicago.org") +
scale_fill_continuous_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(position_control == "1") %>%
group_by(department_description) %>%
summarize(emply_num = sum(total_budgeted_unit)) %>%
ggplot() +
geom_col(aes(
fct_reorder(department_description, emply_num),
emply_num,
fill = emply_num)
) +
labs(title = "Number of Salaried Positions by Department",
caption = "*source: data.cityofchicago.org*") +
scale_fill_continuous_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
ts_FY21 %>%
filter(department_code == 57 &
position_control == "1") %>%
# label peace officers by title codes & title description
mutate(
peace_officer = case_when(
title_code %in% PO_title_codes ~ "Peace Officer",
str_detect(title_description, "Police Officer") ~ "Peace Officer",
str_detect(title_description, "Deputy Superintendent") ~ "Peace Officer",
TRUE ~ "Non Peace Officer")
) %>%
group_by(peace_officer) %>%
summarize(total_app = sum(total_budgeted_amount)/1000000) %>%
ggplot() +
geom_col(aes(peace_officer, total_app),
fill = "skyblue",
alpha = 0.7) +
labs(title = "Salary Appropriation by Job Type") +
scale_y_continuous(labels = dollar_format()) +
theme_fivethirtyeight() +
theme(panel.grid.major.x = element_blank())
ts_FY21 %>%
filter(department_code == 57 &
position_control == "1") %>%
# label peace officers by title codes & title description
mutate(
peace_officer = case_when(
title_code %in% PO_title_codes ~ "Peace Officer",
str_detect(title_description, "Police Officer") ~ "Peace Officer",
str_detect(title_description, "Deputy Superintendent") ~ "Peace Officer",
TRUE ~ "Non Peace Officer")
) %>%
group_by(peace_officer) %>%
summarize(total_app = sum(total_budgeted_amount)/1000000) %>%
ggplot() +
geom_col(aes(peace_officer, total_app),
fill = "skyblue",
alpha = 0.7) +
labs(title = "Salary Appropriation by Job Type",
subtitle = "Millions of $") +
scale_y_continuous(labels = dollar_format()) +
theme_fivethirtyeight() +
theme(panel.grid.major.x = element_blank())
corp_top_ten <- FY21 %>%
filter(fund_description == "CORPORATE FUND") %>%
group_by(department_description) %>%
summarize(total_app = sum(ordinance_amount)) %>%
arrange(desc(total_app)) %>%
head(10) %>%
rename("top_ten" = department_description)
FY21 %>%
filter(fund_description == "CORPORATE FUND") %>%
mutate(department_description = if_else(
!department_description %in% corp_top_ten$top_ten,
"MISCELLANEOUS",
department_description
)
) %>%
group_by(department_description) %>%
summarize(total_app = sum(ordinance_amount)) %>%
mutate(total_app = round(total_app / 1000000),
money = paste0("$", total_app)) %>%
treemap(
index = c("department_description", "money"),
vSize = "total_app",
type = "index",
title = "Chicago Corporate Fund Allocations, Millions of $",
palette = "GnBu",
fontsize.labels = c(10, 10),
fontcolor.labels = c("black", "black"),
bg.labels=c("transparent"),
align.labels = list(c("left", "top"),
c("right", "bottom")),
inflate.labels = F)
# bar chart for CPD, again for legibility we are restricting part of the total
FY21 %>%
filter(department_number == "57") %>%
group_by(appropriation_account_description) %>% # 'expense type'
summarize(total_app = sum(ordinance_amount)) %>%
# for better visibility, we're filtering out less than 2M
filter(total_app >= 2000000) %>%
mutate(total_app = round(total_app / 1000000)) %>%
ggplot() +
geom_col(aes(
fct_reorder(appropriation_account_description, total_app),
total_app,
fill = total_app)
) +
labs(title = "CPD 2021 Budget Appropriations",
subtitle = "Millions of Dollars") +
scale_y_continuous(labels = dollar_format()) +
scale_fill_continuous_tableau() +
theme_fivethirtyeight() +
theme(legend.position = "none",
panel.grid.major.y = element_blank(),
axis.text.y = element_text(size = 8)) +
coord_flip()
# okay so as we can see, CPD is mostly a payroll expense
# we'll come back around to this appropriation account description mess below
# pension fund is noticeably absent, b/c its a separate fund
# so next part is to lookit at positions and salaries
# this equivalent to isolating the payroll budget line in the chart above
test <- FY21 %>%
filter(department_number == "57") %>%
group_by(appropriation_account_description) %>% # 'expense type'
summarize(total_app = sum(ordinance_amount)) %>%
view()
test2 <- FY21 %>%
filter(fund_code == "0687") %>%
view()
test2 <- FY21 %>%
filter(fund_code == "0683") %>%
view()
# just like the titles list, this is obviously unwieldy and un-interpret-able
FY21 %>%
filter(fund_code == "0683" | # policeman's annuity fund
department_number == "55" | # police department
department_number == "57" | # police board
department_number == "60" | # copa
appropriation_account_description == "CONSENT DECREE") %>% # misc consent decree
group_by(appropriation_account_description) %>%
summarise(total_app = sum(ordinance_amount)) %>%
arrange(desc(total_app)) %>%
kable(align = "lccrr",
format.args = list(big.mark = ","),
caption = "Total Costs",
col.names = c("Appropriation Type", "Total Appropriation ($)"),
"simple",
table.placement = "H")
test <- FY21 %>%
filter(department_description == "COPA") %>%
view()
test <- FY21 %>%
filter(fund_code == "0683" | # policeman's annuity fund
department_number == "55" | # police department
department_number == "57" | # police board
department_number == "60" | # copa
appropriation_account_description == "CONSENT DECREE") %>%
group_by(appropriation_account_description) %>%
summarise(total_app = sum(ordinance_amount))
sum(test$total_app)
# start with long list of titles. position control == "1" indicates salary position.
# hourly positions account for about 10M
ts_FY21 %>%
filter(department_code == 57 &
position_control == "1") %>%
group_by(title_description) %>%
summarize(total_app = sum(total_budgeted_amount),
total_employed = sum(total_budgeted_unit)) %>%
arrange(desc(total_app)) %>%
kable(align = "lccrr",
format.args = list(big.mark = ","),
caption = "CPD Appropriation by Job Title",
col.names = c("Title Description", "Total Appropriation ($)", "Number of Employees"),
"simple",
table.placement = "H")
# we see a lot of police officers assigned with varying titles
# treemap as table
FY21 %>%
mutate(fund_description = if_else(
!fund_description %in% top_ten_FY21$top_ten,
"MISCELLANEOUS",
fund_description
)
) %>%
group_by(fund_description) %>%
summarize(total_app = sum(ordinance_amount)) %>%
mutate(perc_total = round((total_app/sum(total_app))*100, 2)) %>%
arrange(desc(total_app)) %>%
kable(align = "lccrr",
format.args = list(big.mark = ","),
caption = "Chicago Budget Appropriations by Fund",
col.names = c("Fund Description", "Total Appropriation ($)", "% of Total"),
"simple",
table.placement = "H")
